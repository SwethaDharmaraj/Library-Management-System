<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background-color: whitesmoke;
        }
        .card {
            border-radius: 10px;
            transition: 0.3s ease-in-out;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .card:hover {
            transform: scale(1.05);
        }
        .container {
            margin-top: 50px;
        }
        h1, h2 {
            text-align: center;
            color: #343a40;
        }
      
    .stats-container {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-bottom: 30px;
        flex-wrap: wrap;
    }

    .stat-card {
        width: 280px;
        padding: 20px;
        border-radius: 12px;
        color: #fff;
        text-align: center;
        font-weight: bold;
        box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
        transition: transform 0.3s ease-in-out;
    }

    .stat-card:hover {
        transform: translateY(-5px);
    }

    .available-books {
        background: linear-gradient(135deg, #00c853, #1b5e20); /* Green gradient */
    }

    .borrowed-books {
        background: linear-gradient(135deg, #d50000, #880e4f); /* Red gradient */
    }

    .stat-card h3 {
        font-size: 18px;
        margin-bottom: 8px;
    }

    .stat-card p {
        font-size: 32px;
        margin: 0;
    }


    </style>
</head>
<body>
    <div class="container">
        <h1>Welcome, {{ username }}!</h1>
        <div class="stats-container">
            <div class="stat-card available-books">
                <h3>üìö Total Available Books</h3>
                <p id="totalAvailable">{{ total_available_books }}</p>
            </div>
            
            <div class="stat-card borrowed-books">
                <h3>üìï Total Borrowed Books</h3>
                <p id="totalBorrowed">{{ total_borrowed_books }}</p>
            </div>
        </div>
        
        
        

           <!-- Search Books Section -->
           <h2 class="mt-4">Search for Books</h2>
           
           <form action="{{ url_for('dashboard') }}" method="GET" class="mb-4">
               <div class="input-group">
                   <select name="search_by" class="form-select">
                       <option value="title">Search by Title</option>
                       <option value="author">Search by Author</option>
                       <option value="category">Search by Category</option>
                   </select>
                   <br>
                   <br>
                   <input type="text" name="query" placeholder="Enter search term" class="form-control" required>
                   <button type="submit" class="btn btn-primary">Search</button>
               </div>
           </form>

           {% if is_admin %}
           <div class="add-book-container">
               <a href="{{ url_for('add_book') }}" class="btn btn-primary">‚ûï Add a New Book</a>
           </div>
       {% endif %}
       

       <!-- Available Books Section -->
<h2 class="mt-4 text-center">üìö Available Books</h2>

<div class="table-responsive">
    <table class="table table-bordered table-striped align-middle mt-3">
        <thead class="table-dark">
            <tr>
                <th>üìñ Title</th>
                <th>‚úçÔ∏è Author</th>
                <th>üè∑Ô∏è Category</th>
                <th>üî¢ Count</th>
                <th>üéØ Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for book in books %}
            <tr>
                <td>{{ book.title }}</td>
                <td>{{ book.author }}</td>
                <td>{{ book.category }}</td>
                <td>{{ book.count }}</td>
                <td>
                    {% if book.count > 0 %}
                        <a href="{{ url_for('borrow_book', isbn=book.isbn) }}" class="btn btn-sm btn-primary">Borrow</a>
                    {% else %}
                        <button class="btn btn-sm btn-secondary" disabled>Out of Stock</button>
                    {% endif %}
                    
                    {% if is_admin %}
                        <a href="{{ url_for('delete_book', isbn=book.isbn) }}" class="btn btn-sm btn-danger">Delete</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


     <!-- Borrowed Books Section -->
<h2 class="mt-4">Borrowed Books</h2>
<div class="table-responsive">
    <table class="table table-bordered table-hover align-middle">
         <thead class="table-light">
            <tr>
                <th>üìñ Title</th>
                <th>‚úçÔ∏è Author</th>
                <th>üè∑Ô∏è Category</th>
                <th>üî¢ Count</th>
                <th>üéØ Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for book in borrowed_books %}
            <tr>
                <td>{{ book.title }}</td>
                <td>{{ book.author }}</td>
                <td>{{ book.isbn }}</td>
                <td>{{ book.category }}</td>
                <td>{{ book.borrowed_by }}</td>
                <td>
                    <a href="{{ url_for('return_book', isbn=book.isbn) }}" class="btn btn-warning btn-sm">Return</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>


        <!-- Logout -->
        <div class="text-center">
            <a href="{{ url_for('logout') }}" class="btn btn-secondary mt-4">Logout</a>
        </div>
    </div>

    <input type="text" id="searchBox" placeholder="Search books..." class="form-control">

<div id="searchResults">
    <!-- Search results will appear here -->
</div>

<script>
document.getElementById("searchBox").addEventListener("keyup", function() {
    let query = this.value.trim();

    if (query === "") {
        document.getElementById("searchResults").innerHTML = ""; // Clear results
        return;
    }

    fetch(`/search_books?query=${encodeURIComponent(query)}`)
        .then(response => response.json())
        .then(books => {
            let resultsHTML = "";

            if (books.length === 0) {
                resultsHTML = "<p>No results found</p>";
            } else {
                resultsHTML = "<ul class='list-group'>";
                books.forEach(book => {
                    resultsHTML += `<li class='list-group-item'>
                        <strong>${book.title}</strong> by ${book.author} <br>
                        <small>Category: ${book.category}</small>
                    </li>`;
                });
                resultsHTML += "</ul>";
            }

            document.getElementById("searchResults").innerHTML = resultsHTML;
        })
        .catch(error => console.error("Error:", error));
});
</script>
<a href="{{ url_for('leave_review') }}" class="btn btn-primary">Leave a Review</a>


</body>
</html>
